"""init

Revision ID: 2906cac84ace
Revises: 
Create Date: 2025-12-14 19:21:22.405956

"""
from alembic import op
import sqlalchemy as sa
import sqlmodel.sql.sqltypes
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = '2906cac84ace'
down_revision = None
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('optimization_batches',
    sa.Column('id', sa.Uuid(), nullable=False),
    sa.Column('batch_date', sa.DateTime(), nullable=False),
    sa.Column('status', sa.Enum('PENDING', 'PROCESSING', 'COMPLETED', 'FAILED', name='optimizationbatchstatus'), nullable=False),
    sa.Column('total_trips', sa.Integer(), nullable=False),
    sa.Column('km_saved', sa.Float(), nullable=True),
    sa.Column('fuel_saved_liters', sa.Float(), nullable=True),
    sa.Column('vehicles_used', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('completed_at', sa.DateTime(), nullable=True),
    sa.Column('solver_time_seconds', sa.Float(), nullable=True),
    sa.Column('solver_status', sqlmodel.sql.sqltypes.AutoString(), nullable=True),
    sa.Column('optimization_type', sqlmodel.sql.sqltypes.AutoString(), nullable=False),
    sa.Column('participating_companies', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('total_companies', sa.Integer(), nullable=False),
    sa.Column('total_vehicles_shared', sa.Integer(), nullable=False),
    sa.Column('total_km_saved', sa.Float(), nullable=False),
    sa.Column('total_fuel_saved', sa.Float(), nullable=False),
    sa.Column('company_results', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_optimization_batches_batch_date'), 'optimization_batches', ['batch_date'], unique=False)
    op.create_table('user',
    sa.Column('email', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('is_superuser', sa.Boolean(), nullable=False),
    sa.Column('full_name', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True),
    sa.Column('id', sa.Uuid(), nullable=False),
    sa.Column('hashed_password', sqlmodel.sql.sqltypes.AutoString(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_user_email'), 'user', ['email'], unique=False)
    op.create_table('companies',
    sa.Column('company_name', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
    sa.Column('nis', sqlmodel.sql.sqltypes.AutoString(length=15), nullable=False),
    sa.Column('nif', sqlmodel.sql.sqltypes.AutoString(length=20), nullable=False),
    sa.Column('headquarters_address', sqlmodel.sql.sqltypes.AutoString(length=500), nullable=False),
    sa.Column('company_type', sa.Enum('PRODUCTION', 'TRADING', 'SERVICE', name='companytype'), nullable=False),
    sa.Column('activity_sector', sa.Enum('AGROALIMENTAIRE', 'CONSTRUCTION', 'INDUSTRIAL', 'CHEMICAL', 'AGRICULTURAL', 'LOGISTICS', 'MEDICAL', 'HYGIENE', 'ENERGY', 'SPECIAL', 'OTHER', name='activitysector'), nullable=False),
    sa.Column('sector_specification', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True),
    sa.Column('partner_type', sa.Enum('COMPANY', 'LOGISTICS_PROVIDER', name='partnertype'), nullable=False),
    sa.Column('legal_representative_name', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
    sa.Column('legal_representative_contact', sqlmodel.sql.sqltypes.AutoString(length=50), nullable=False),
    sa.Column('logo_url', sqlmodel.sql.sqltypes.AutoString(length=500), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('is_verified', sa.Boolean(), nullable=False),
    sa.Column('depot_lat', sa.Float(), nullable=True),
    sa.Column('depot_lng', sa.Float(), nullable=True),
    sa.Column('depot_address', sqlmodel.sql.sqltypes.AutoString(length=500), nullable=True),
    sa.Column('id', sa.Uuid(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('user_id', sa.Uuid(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['user.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_companies_company_name'), 'companies', ['company_name'], unique=False)
    op.create_index(op.f('ix_companies_nif'), 'companies', ['nif'], unique=True)
    op.create_index(op.f('ix_companies_nis'), 'companies', ['nis'], unique=True)
    op.create_table('company_optimization_results',
    sa.Column('id', sa.Uuid(), nullable=False),
    sa.Column('optimization_batch_id', sa.Uuid(), nullable=False),
    sa.Column('company_id', sa.Uuid(), nullable=False),
    sa.Column('trips_contributed', sa.Integer(), nullable=False),
    sa.Column('trips_assigned', sa.Integer(), nullable=False),
    sa.Column('vehicles_used', sa.Integer(), nullable=False),
    sa.Column('vehicles_shared_out', sa.Integer(), nullable=False),
    sa.Column('vehicles_borrowed', sa.Integer(), nullable=False),
    sa.Column('km_saved', sa.Float(), nullable=False),
    sa.Column('fuel_saved_liters', sa.Float(), nullable=False),
    sa.Column('co2_saved_kg', sa.Float(), nullable=False),
    sa.Column('cost_saved_usd', sa.Float(), nullable=False),
    sa.Column('chains_participated', sa.Integer(), nullable=False),
    sa.Column('average_chain_length', sa.Float(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['company_id'], ['companies.id'], ),
    sa.ForeignKeyConstraint(['optimization_batch_id'], ['optimization_batches.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('map_markers',
    sa.Column('id', sa.Uuid(), nullable=False),
    sa.Column('company_id', sa.Uuid(), nullable=False),
    sa.Column('name', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
    sa.Column('lat', sa.Float(), nullable=False),
    sa.Column('lng', sa.Float(), nullable=False),
    sa.Column('marker_type', sqlmodel.sql.sqltypes.AutoString(), nullable=False),
    sa.Column('address', sqlmodel.sql.sqltypes.AutoString(length=500), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.ForeignKeyConstraint(['company_id'], ['companies.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('vehicles',
    sa.Column('license_plate', sqlmodel.sql.sqltypes.AutoString(length=20), nullable=False),
    sa.Column('category', sa.Enum('AG1', 'AG2', 'AG3', 'AG4', 'AG5', 'AG6', 'BT1', 'BT2', 'BT3', 'BT4', 'BT5', 'BT6', 'IN1', 'IN2', 'IN3', 'IN4', 'IN5', 'IN6', 'CH1', 'CH2', 'CH3', 'CH4', 'CH5', name='vehiclecategory'), nullable=False),
    sa.Column('capacity_tons', sa.Float(), nullable=True),
    sa.Column('capacity_m3', sa.Float(), nullable=True),
    sa.Column('status', sa.Enum('AVAILABLE', 'IN_MISSION', 'MAINTENANCE', 'INACTIVE', name='vehiclestatus'), nullable=False),
    sa.Column('current_km', sa.Float(), nullable=False),
    sa.Column('last_technical_control', sa.DateTime(), nullable=True),
    sa.Column('insurance_expiry', sa.DateTime(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('year', sa.Integer(), nullable=True),
    sa.Column('brand', sqlmodel.sql.sqltypes.AutoString(length=100), nullable=True),
    sa.Column('model', sqlmodel.sql.sqltypes.AutoString(length=100), nullable=True),
    sa.Column('fuel_type', sqlmodel.sql.sqltypes.AutoString(length=50), nullable=True),
    sa.Column('cost_per_km', sa.Float(), nullable=True),
    sa.Column('fuel_consumption_l_per_100km', sa.Float(), nullable=True),
    sa.Column('depot_lat', sa.Float(), nullable=True),
    sa.Column('depot_lng', sa.Float(), nullable=True),
    sa.Column('id', sa.Uuid(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('company_id', sa.Uuid(), nullable=False),
    sa.ForeignKeyConstraint(['company_id'], ['companies.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_vehicles_license_plate'), 'vehicles', ['license_plate'], unique=True)
    op.create_table('trips',
    sa.Column('departure_point', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
    sa.Column('departure_lat', sa.Float(), nullable=True),
    sa.Column('departure_lng', sa.Float(), nullable=True),
    sa.Column('arrival_point', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
    sa.Column('arrival_lat', sa.Float(), nullable=True),
    sa.Column('arrival_lng', sa.Float(), nullable=True),
    sa.Column('departure_datetime', sa.DateTime(), nullable=False),
    sa.Column('arrival_datetime_planned', sa.DateTime(), nullable=False),
    sa.Column('arrival_datetime_actual', sa.DateTime(), nullable=True),
    sa.Column('cargo_category', sa.Enum('A01', 'A02', 'A03', 'A04', 'A05', 'A06', 'B01', 'B02', 'B03', 'B04', 'B05', 'I01', 'I02', 'I03', 'I04', 'I05', 'C01', 'C02', 'C03', 'C04', 'C05', name='cargocategory'), nullable=False),
    sa.Column('material_type', sa.Enum('SOLID', 'LIQUID', 'GAS', name='materialtype'), nullable=False),
    sa.Column('cargo_weight_kg', sa.Float(), nullable=False),
    sa.Column('driver_name', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True),
    sa.Column('status', sa.Enum('PLANNED', 'IN_PROGRESS', 'COMPLETED', 'CANCELLED', name='tripstatus'), nullable=False),
    sa.Column('distance_km', sa.Float(), nullable=True),
    sa.Column('duration_minutes', sa.Integer(), nullable=True),
    sa.Column('return_distance_km', sa.Float(), nullable=True),
    sa.Column('notes', sqlmodel.sql.sqltypes.AutoString(length=1000), nullable=True),
    sa.Column('route_polyline', sqlmodel.sql.sqltypes.AutoString(), nullable=True),
    sa.Column('route_distance_km', sa.Float(), nullable=True),
    sa.Column('route_duration_min', sa.Integer(), nullable=True),
    sa.Column('estimated_arrival_datetime', sa.DateTime(), nullable=True),
    sa.Column('return_route_polyline', sqlmodel.sql.sqltypes.AutoString(), nullable=True),
    sa.Column('return_duration_min', sa.Integer(), nullable=True),
    sa.Column('loading_window_start', sa.DateTime(), nullable=True),
    sa.Column('loading_window_end', sa.DateTime(), nullable=True),
    sa.Column('delivery_window_start', sa.DateTime(), nullable=True),
    sa.Column('delivery_window_end', sa.DateTime(), nullable=True),
    sa.Column('hazardous_material', sa.Boolean(), nullable=False),
    sa.Column('temperature_requirement_celsius', sa.Float(), nullable=True),
    sa.Column('trip_priority', sa.Integer(), nullable=False),
    sa.Column('trip_date', sa.DateTime(), nullable=True),
    sa.Column('uploaded_at', sa.DateTime(), nullable=True),
    sa.Column('route_calculated', sa.Boolean(), nullable=False),
    sa.Column('optimization_status', sqlmodel.sql.sqltypes.AutoString(), nullable=False),
    sa.Column('created_from_map', sa.Boolean(), nullable=False),
    sa.Column('map_session_id', sqlmodel.sql.sqltypes.AutoString(length=50), nullable=True),
    sa.Column('id', sa.Uuid(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('company_id', sa.Uuid(), nullable=False),
    sa.Column('vehicle_id', sa.Uuid(), nullable=False),
    sa.Column('optimization_batch_id', sa.Uuid(), nullable=True),
    sa.Column('assigned_vehicle_id', sa.Uuid(), nullable=True),
    sa.Column('sequence_order', sa.Integer(), nullable=True),
    sa.Column('is_last_in_chain', sa.Boolean(), nullable=False),
    sa.ForeignKeyConstraint(['company_id'], ['companies.id'], ),
    sa.ForeignKeyConstraint(['vehicle_id'], ['vehicles.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_trips_optimization_batch_id'), 'trips', ['optimization_batch_id'], unique=False)
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_trips_optimization_batch_id'), table_name='trips')
    op.drop_table('trips')
    op.drop_index(op.f('ix_vehicles_license_plate'), table_name='vehicles')
    op.drop_table('vehicles')
    op.drop_table('map_markers')
    op.drop_table('company_optimization_results')
    op.drop_index(op.f('ix_companies_nis'), table_name='companies')
    op.drop_index(op.f('ix_companies_nif'), table_name='companies')
    op.drop_index(op.f('ix_companies_company_name'), table_name='companies')
    op.drop_table('companies')
    op.drop_index(op.f('ix_user_email'), table_name='user')
    op.drop_table('user')
    op.drop_index(op.f('ix_optimization_batches_batch_date'), table_name='optimization_batches')
    op.drop_table('optimization_batches')
    # ### end Alembic commands ###
